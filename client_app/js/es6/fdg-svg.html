<script type="text/javascript">
//No need for a template or shadow dom because we use vdom.
(() => {
    const {
        render,
        El
    } = require('./vdom.js');
    const { renderGraph, sizer } = require('./render.graph.js');
    const { emitter } = require('./emitter.js');
    const { fdg } = require('./fdg.js');


    class FdgSvg extends HTMLElement {
        createdCallback() {
            console.debug('FdgSvg createdCallback', this);
            // TODO: perhaps create render function here...
            // TODO: add correct method of acquiring graph data
            let prev = null;
            this.render = () => {
                const { tree } = fdg;
                let next;
                if (!tree) {
                    next = El('h1', {}, 'No graph loaded');
                } else {
                    next = renderGraph(tree);
                }
                render(document, this, next, prev);
                prev = next;
            };
        }
        attachedCallback() {
            emitter.on('fdg:render', this.render);
            this.innerHTML = '';
        }
        detachedCallback() {
            emitter.off('fdg:render', this.render);
        }
        attributeChangedCallback(attr, oldVal, newVal) {
            console.debug('FdgSvg attributeChangedCallback', this, { attr, oldVal, newVal });
        }
    }

    document.registerElement('fdg-svg', FdgSvg);

})();

</script>
